<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Can Wales Live with Fire?</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <section id="scroll-1">
      <div class="scroll-graphic">
        <div class="image-container-1">
          <img
            id="img-1"
            src="https://media.githubusercontent.com/media/ratnarekham/wildfire-scroller/refs/heads/main/images/march_19.png"
            alt="March 19 Image"
          />
          <img
            id="img-2"
            src="https://media.githubusercontent.com/media/ratnarekham/wildfire-scroller/refs/heads/main/images/april_5.png"
            alt="April 5 Image"
          />
          <img
            id="img-3"
            src="https://media.githubusercontent.com/media/ratnarekham/wildfire-scroller/refs/heads/main/images/may_15.png"
            alt="May 15 Image"
          />
        </div>
      </div>

      <div class="scroll-text">
        <div class="step" data-step="1">
          <p>
            2025 has brought Wales its most extreme wildfire season on
            record.<br />
            <br />
            But just how bad has it been? <br />
          </p>
        </div>
        <div class="step" data-step="1">
          <p>
            On
            <span style="background-color: rgb(218, 248, 140)">March 19</span>
            satellites captured this view of Wales from space.<br />
            <br />
            That day, fires were burning in atleast 19 different locations.
            <br />
            <br />
            Two of them emitted smoke visible from space.
          </p>
        </div>
        <div class="step" data-step="2">
          <p>
            Near the seaside town of Aberystwyth, a fire that had started the
            day before was still burning.
          </p>
        </div>
        <div class="step" data-step="3">
          <p>
            In the small village of Llanfairtalhaiarn, smoke stretched for miles
            across the countryside.
          </p>
        </div>
        <div class="step" data-step="4">
          <p>
            By the end of March, Wales had lost more land to fire than all the
            other UK nations combined. <br />
            <br />
            Around 4,700 hectares, almost the size of Cardiff, had burned in
            just one month. <br />
            <br />
            And, this was only the beginning.
          </p>
        </div>
        <div class="step" data-step="5">
          <p>
            April turned out to be the worst month on record for land burned.<br />
            <br />
            On a rare, cloudless day
            <span style="background-color: rgb(248, 140, 234)">April 5th</span>,
            satellites recorded fires in atleast four different places around
            Wales.
          </p>
        </div>
        <div class="step" data-step="6">
          <p>
            One of the largest UK wildfires this year broke out in Ystard Fflur,
            burning for three days. As of April 8, the cause remains unknown.
          </p>
        </div>
        <div class="step" data-step="7">
          <p>
            More than a month later, on
            <span style="background-color: rgb(153, 140, 248)">May 15th</span>,
            the scars of those fires were still clearly visible from space.
          </p>
        </div>
        <div class="step" data-step="8">
          <p>
            What Wales experienced in 2025 was unprecedented. <br />
            <br />
            The UK as a whole recorded its highest burnt area since recording
            began in 2012.
          </p>
        </div>
        <div class="step" data-step="9">
          <p>What does this mean for the future of Wales?</p>
        </div>
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <script>
      //scrollama setupp
      const scroller1 = scrollama();

      function addCircle(step) {
        d3.selectAll(".zoom-circle").remove();

        const container1 = d3.select(".image-container-1");
        let circleData;

        // circle highlights
        switch (step) {
          case 2:
            circleData = { cx: "13.7%", cy: "47%", r: 10, color: "pink" };
            break;
          case 3:
            circleData = { cx: "15.5%", cy: "21%", r: 10, color: "pink" };
            break;
          default:
            return;
        }
        let svg = container1.select("svg.circle-overlay");
        if (svg.empty()) {
          svg = container1
            .append("svg")
            .attr("class", "circle-overlay")
            .style("position", "absolute")
            .style("top", "0")
            .style("left", "0")
            .style("width", "100%")
            .style("height", "100%")
            .style("pointer-events", "none")
            .style("z-index", "10");
        }

        svg
          .append("circle")
          .attr("class", "zoom-circle")
          .attr("cx", circleData.cx)
          .attr("cy", circleData.cy)
          .attr("r", 0)
          .style("fill", "solid")
          .attr("fill", circleData.color)
          .attr("fill-opacity", 0.1)
          .style("stroke", circleData.color)
          .style("stroke-width", "0.5px")
          .style("opacity", 0.1)
          .transition()
          .duration(500)
          .attr("r", circleData.r)
          .style("opacity", 1);
      }

      // rectangle highlights
      function addRectHighlight(step) {
        d3.selectAll(".zoom-highlight").remove();

        const container1 = d3.select(".image-container-1");
        let rectData;

        switch (step) {
          // case 3:
          //   rectData = { x: "17%", y: "75%", width: "2%", height: "5%", color: "pink" };
          //   break;
          case 6:
            rectData = {
              x: "65.5%",
              y: "52%",
              width: "2%",
              height: "6%",
              color: "pink",
            };
            break;
          case 7:
            rectData = {
              x: "115.3%",
              y: "51.5%",
              width: "2%",
              height: "6%",
              color: "pink",
            };
            break;
          default:
            return;
        }
        let svg = container1.select("svg.highlight-overlay");
        if (svg.empty()) {
          svg = container1
            .append("svg")
            .attr("class", "highlight-overlay")
            .style("position", "absolute")
            .style("top", "0")
            .style("left", "0")
            .style("width", "100%")
            .style("height", "100%")
            .style("pointer-events", "none")
            .attr("overflow", "visible")
            .style("z-index", "10");
        }
        svg
          .append("rect")
          .attr("class", "zoom-highlight")
          .attr("x", rectData.x)
          .attr("y", rectData.y)
          .attr("width", "0%")
          .attr("height", "0%")
          .style("fill", "solid")
          .attr("fill", rectData.color)
          .attr("fill-opacity", 0.1)
          .style("stroke", rectData.color)
          .style("stroke-width", "0.5px")
          .style("opacity", 0)
          .transition()
          .duration(800)
          .attr("width", rectData.width)
          .attr("height", rectData.height)
          .style("opacity", 1);
      }
      // zooming in
      function zoom1(step) {
        const image1 = d3.select(".image-container-1");

        let transform;
        switch (step) {
          case 0:
            transform = "scale(1) translate(0px, 0px)"; //march 19
            break;
          case 1:
            transform = "scale(1.5) translate(230px, 0px)"; //march 19
            break;
          case 2:
            transform = "scale(5.6) translate(415px, 25px)";
            break;
          case 3:
            transform = "scale(5.6) translate(390px, 160px)";
            break;
          case 4:
            transform = "scale(1.5) translate(230px, 0px)";
            break;
          case 5:
            transform = "scale(1.5) translate(-550px, 0px)"; //april 5
            break;
          case 6:
            transform = "scale(5.6) translate(-355px, -20px)";
            break;
          case 7:
            transform = "scale(5.6) translate(-1085px, -20px)";
            break;
          case 8:
            transform = "scale(1.5) translate(-1250px, 0px)"; // may 15
            break;
          case 9:
            transform = "scale(0.5) translate(-1700px, 0px)";
            break;
          default:
            transform = "scale(1) translate(0px, 0px)";
        }
        image1.style("transform", transform);

        setTimeout(() => {
          addCircle(step); // Use addCircle, addPulsingCircle, or addRectHighlight
        }, 2500);

        setTimeout(() => {
          addRectHighlight(step); // Use addCircle, addPulsingCircle, or addRectHighlight
        }, 2500);
      }

      function init1() {
        const steps1 = d3.selectAll("#scroll-1 .step");

        scroller1
          .setup({
            step: "#scroll-1 .step",
            offset: 0.5,
            debug: false,
          })
          .onStepEnter((response) => {
            steps1.classed("is-active", (d, i) => i === response.index);
            zoom1(response.index);
          });

        window.addEventListener("resize", scroller1.resize);
      }

      // kick it off
      init1();
    </script>

    <div class="main-article">
      <div class="headline">Counting the flames behind Wales' Wildfires</div>
      <div class="para">
        Wildfires are no strangers in Wales. From pine trees to bracken ferns,
        they have shaped the landscape and the ecosystems as we know them today.
        But this year's fires looked nothing like those of the past. <br />
        <br />
        They were larger, faster and harder to control than anything seen in
        recent memory. The scale of the crisis this year raises an urgent
        question - what changed? <br />
      </div>
      <div class="sub">
        Wildfire season is now starting earlier and lasting longer.
      </div>
      <div class="para">
        Researchers at _____ did this to find out that wildfires are longer now.
        <br />
        <br />Spring wildfires are not uncommon in Wales. Fires clear the land
        of undergrowth, making way for new shoots to sprout. And rain would help
        extinguish these fires. <br />
        <br />
        2025 however saw the warmest and driest spring since records began. With
        high temperatures, abundant growth and, no rain, the stage was set for a
        catastrophic wildfire season. <br />
        <br />
        Scientist call days with such conditions 'high fire weather'. And they
        expect more of these days in the future. Douglas I Kelley, wildfire
        scientist at the UK Centre for Ecology & Hydrology, attributes this to
        climate change. This year, the UK experienced atleast 7 successive
        heatwaves according to the MET Office. Heatwaves dry out vegetation,
        making it more flammable. <br />
      </div>
      <div class="sub">Successive heatwaves 'shocked' the system.</div>
      <div class="para">
        The multiple heatwaves have "shocked the system," says Dr. Gareth Clay,
        professor of geography at Manchester University. Due to this, fires were
        able to spread rapidly, overwhelming firefighting efforts. <br />
        <br />
      </div>
      <div class="sub">
        Is burnt area an effective indicator of what's to come?
      </div>
      <div class="para">
        Interestingly, global burnt area is on the decline. But this isn't
        necessarily a positive sign.<br />
        <br />
        Fires are now more intense and destructive, and more people are being
        exposed to them. Researchers at ____ found that despite warming
        temperatures, lesser land is being burnt than before.
      </div>
      <div class="charts" id="1">
        <div class="chart-title">
          Burnt Area in the United Kingdom (2015 - 2025)
        </div>
        <div class="chart-subtitle">
          This year saw the UK experience record high burnt area. Wales and
          Scotland also reached record levels.
        </div>
        <div id="totalburnedarea_chart"></div>
        <div class="source-text">
          <p>
            As of 1 July 2025. EFFIS only maps fires that are approximately 30ha
            or larger. <br />
            Source: European Forest Fire Information System (<a
              href="https://forest-fire.emergency.copernicus.eu"
              target="_blank"
              >EFFIS</a
            >).
          </p>
        </div>
      </div>

      <br />

      <!-- <div class="charts" id="2">
          <div class="chart-title">Burnt Area Per Month in 2025</div>
          <div class="chart-subtitle">April saw the largest burnt area.</div>
          <div id="burnedarea2025"></div>
          <div class="source-text">
            <p>
              As of 1 July 2025. EFFIS only maps fires that are approximately
              30ha or larger. <br />
              Source: European Forest Fire Information System (<a
                href="https://forest-fire.emergency.copernicus.eu"
                target="_blank"
                >EFFIS</a
              >).
            </p>
          </div>
        </div> -->

      <div class="para">
        "The challenge ahead is integrating fire science, data, and local
        knowledge to improve prediction, management, and prevention—this is
        vital as wildfires become a more frequent reality."
      </div>
    </div>

    <!-- climate whiplash  -->

    <section id="scroll-2">
      <div class="sticky-container">
        <div class="scroll-header">
          <div class="sub">What is the 'climate whiplash' effect?</div>
        </div>
        <div class="scroll-graphic-2">
          <div class="image-container-2">
            <div class="charts" id="3">
              <div id="anomalieschart"></div>
            </div>
          </div>
        </div>
        <div class="sticky-source">
          <div class="source-text">
            <p>
              As of 1 August 2025.<br />
              All values are compared to the 1991–2020 average. Negative
              anomalies before 1991 indicate years cooler than the modern
              normal. <br />
              Source: Met Office National Climate Information Centre (<a
                href="https://www.metoffice.gov.uk/research/climate/maps-and-data/uk-and-regional-series"
                target="_blank"
                >Climate Data</a
              >).
            </p>
          </div>
        </div>
      </div>

      <div class="scroll-text-2">
        <div class="step-2" data-step="1">
          <p>
            From 1884, the MET Office has been collecting temperature and
            rainfall every year. <br /><br />
            These dots represent one year from then to 2025.<br />
          </p>
        </div>
        <div class="step-2" data-step="2">
          <p>This is Step 2</p>
        </div>
        <div class="step-2" data-step="3">
          <p>This is Step 3</p>
        </div>
      </div>
    </section>
    <script>
      const scroller2 = scrollama();

      function updateAnomalies(step) {
        switch (step) {
          case 0:
            d3.selectAll(".dot").transition().style("opacity", 1);
            //quadrants
            // d3.select(".v_line").transition().style("opacity", 1);
            // d3.select(".h_line").transition().style("opacity", 1);
            // // Show axes only
            // d3.select(".x-axis").transition().style("opacity", 1);
            // d3.select(".y-axis").transition().style("opacity", 1);
            break;

          case 1:
            // Reveal all scatter dots
            d3.selectAll(".year-dot")
              .transition()
              .duration(600)
              .style("opacity", 0.6);
            break;

          case 2:
            // Emphasize the 2025 dot + label
            d3.selectAll(".year-dot")
              .transition()
              .style("opacity", (d) => (d.year === 2025 ? 1 : 0.2));
            d3.select(".label-2025").transition().style("opacity", 1);
            break;

          case 3:
            // Show 1991–2020 average
            d3.select(".average-dot").transition().style("opacity", 1);
            d3.select(".average-label").transition().style("opacity", 0.8);
            break;

          default:
            break;
        }
      }

      // zooming in
      // function zoom2(step) {
      //   const image2 = d3.select(".image-container-2");

      //   let transform;
      //   switch (step) {
      //     case 0:
      //       transform = "scale(1) translate(0px, 0px)";
      //       break;
      //     case 1:
      //       transform = "scale(2) translate(200px, 0px)";
      //       break;
      //     case 2:
      //       transform = "scale(1) translate(0px, 0px)";
      //       break;
      //     default:
      //       transform = "scale(1) translate(0px, 0px)";
      //   }
      //   image2.style("transform", transform);
      // }
      function init2() {
        const steps2 = d3.selectAll("#scroll-2 .step-2");

        scroller2
          .setup({
            step: "#scroll-2 .step-2",
            offset: 0.5,
            debug: false,
          })
          .onStepEnter((response) => {
            steps2.classed("is-active", (d, i) => i === response.index);
            // zoom2(response.index);
            updateAnomalies(response.index);
          });

        window.addEventListener("resize", scroller2.resize);
      }

      // kick it off
      init2();
    </script>

    <script src="scripts/totalburnedarea.js"></script>
    <script src="scripts/burnarea2025.js"></script>
    <script src="scripts/anomalies2025.js"></script>
  </body>
</html>
